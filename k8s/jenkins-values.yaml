controller:
  admin:
    password: "admin"

  # Installation automatique des plugins
  installPlugins:
    - kubernetes:latest
    - workflow-aggregator:latest
    - git:latest
    - configuration-as-code:latest
    - azure-credentials:latest
    - docker-workflow:latest
    - pipeline-stage-view:latest
    - credentials-binding:latest
    - pipeline-utility-steps:latest

  # Configuration JCasC (Jenkins Configuration as Code)
  JCasC:
    defaultConfig: true
    configScripts:
      welcome-message: |
        jenkins:
          systemMessage: "Jenkins configuré avec Kubernetes Pod Templates"
      kubernetes-cloud: |
        jenkins:
          clouds:
            - kubernetes:
                name: "kubernetes"
                serverUrl: "https://kubernetes.default"
                namespace: "jenkins"
                jenkinsUrl: "http://jenkins:8080"
                jenkinsTunnel: "jenkins-agent:50000"
                connectTimeout: 5
                readTimeout: 15
                containerCapStr: 10
                maxRequestsPerHostStr: 32
                retentionTimeout: 5
                templates:
                  - name: "maven-docker"
                    label: "maven-docker"
                    serviceAccount: "jenkins"
                    nodeUsageMode: "NORMAL"
                    containers:
                      - name: "jnlp"
                        image: "jenkins/inbound-agent:latest"
                        alwaysPullImage: false
                        workingDir: "/home/jenkins/agent"
                        resourceRequestCpu: "500m"
                        resourceRequestMemory: "512Mi"
                        resourceLimitCpu: "1000m"
                        resourceLimitMemory: "1Gi"
                      - name: "maven"
                        image: "maven:3.9-eclipse-temurin-17"
                        command: "/bin/sh -c"
                        args: "cat"
                        ttyEnabled: true
                        workingDir: "/home/jenkins/agent"
                        resourceRequestCpu: "500m"
                        resourceRequestMemory: "1Gi"
                        resourceLimitCpu: "1000m"
                        resourceLimitMemory: "2Gi"
                      - name: "docker"
                        image: "docker:24-dind"
                        ttyEnabled: true
                        privileged: true
                        workingDir: "/home/jenkins/agent"
                        resourceRequestCpu: "500m"
                        resourceRequestMemory: "1Gi"
                        resourceLimitCpu: "1000m"
                        resourceLimitMemory: "2Gi"
                      - name: "azure-cli"
                        image: "mcr.microsoft.com/azure-cli:latest"
                        command: "/bin/sh -c"
                        args: "cat"
                        ttyEnabled: true
                        workingDir: "/home/jenkins/agent"
                        resourceRequestCpu: "200m"
                        resourceRequestMemory: "256Mi"
                        resourceLimitCpu: "500m"
                        resourceLimitMemory: "512Mi"
                      - name: "kubectl"
                        image: "bitnami/kubectl:latest"
                        command: "/bin/bash -c"
                        args: "cat"
                        ttyEnabled: true
                        workingDir: "/home/jenkins/agent"
                        resourceRequestCpu: "100m"
                        resourceRequestMemory: "128Mi"
                        resourceLimitCpu: "200m"
                        resourceLimitMemory: "256Mi"
                      - name: "trivy"
                        image: "aquasec/trivy:latest"
                        command: "/bin/sh -c"
                        args: "cat"
                        ttyEnabled: true
                        workingDir: "/home/jenkins/agent"
                        resourceRequestCpu: "200m"
                        resourceRequestMemory: "256Mi"
                        resourceLimitCpu: "500m"
                        resourceLimitMemory: "512Mi"
                    volumes:
                      - emptyDirVolume:
                          mountPath: "/var/lib/docker"
                          memory: false
                      - emptyDirVolume:
                          mountPath: "/root/.m2"
                          memory: false

  resources:
    requests:
      cpu: "1000m"
      memory: "2Gi"
    limits:
      cpu: "2000m"
      memory: "4Gi"

  serviceType: LoadBalancer
  servicePort: 8080

# Agent configuration - NE PAS utiliser podTemplates ici
agent:
  enabled: true

# Persistence pour les données Jenkins
persistence:
  enabled: true
  storageClass: "default"
  size: 20Gi
  accessMode: ReadWriteOnce

# Service Account et RBAC
serviceAccount:
  create: true
  name: jenkins

rbac:
  create: true
  readSecrets: true